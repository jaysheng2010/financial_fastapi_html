<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
  </head>
  <body>
<div id="mobile_container">
    <div id="hamburger_menu_container">
       <p id="hamburger_menu_btn" onclick="show_hamburger_menu()">☰</p>
       <div>
        <img src="https://atlas-content-cdn.pixelsquid.com/assets_v2/325/3258989548893378054/previews/G03-200x200.jpg">
        <p>Finance</p>
       </div>
       <img src="https://upload.wikimedia.org/wikipedia/commons/thumb/0/01/Created_with_Matplotlib-logo.svg/2048px-Created_with_Matplotlib-logo.svg.png">
    </div>
    
    
    <div id="greeting_mobile">
        <h1>Welcome Back</h1>
        <p>Jason</p>
    </div>
     
    <div id="chart_group_mobile">
         <div class="each_chart">
            <div id="add_chart" class="inside_each_chart">
              <b onclick="show_add_form()">+</b>
            </div>
         </div>
    </div>
</div>

<nav id="hamburger_menu">
  <a id="close_hamburger_menu" class="hamburger_menu_a" onclick="hide_hamburger_menu()">×</a>
  <hr>
  <a class="hamburger_menu_a">Home</a>
  <a class="hamburger_menu_a">Gold</a>
</nav>

<div id="add_on_form">
    <div id="inner_add_on">
        <div id="container_close_btn">
          <button id="close_btn_add" onclick="close_add_form()">×</button>
        </div>
        <h1>Add-on</h1>
        <div id="currency_add_on">
          <p><b>Currency:</b></p>
          <div>
              <div>
                <button id="choice_from" onclick="open_dropdown_from()">MYR</button>
                <ul id="list_currencies_from">
                </ul>
              </div>
              <p>to</p>
              <div>
                <button id="choice_to" onclick="open_dropdown_to()">MYR</button>
                <ul id="list_currencies_to">
                </ul>
              </div>
          </div>
        </div>
        <br>

        <div>
          <input type="radio" name="time_type" id="hour" class="time_class_form_add" value="hour">
          <label for="hour" class="time_label_class_form_add">Hour</label>
          <br>
          <input type="radio" name="time_type" id="days" class="time_class_form_add" value="day">
          <label for="days" class="time_label_class_form_add">Days</label>
          <br>
          <input type="radio" name="time_type" id="months" class="time_class_form_add" value="month">
          <label for="months" class="time_label_class_form_add">Months</label>
          <br>
          <input type="radio" name="time_type" id="years" class="time_class_form_add" value="year">
          <label for="years" class="time_label_class_form_add">Years</label>
        </div>

        <br>

        <div id="intersection_choice">
          <input type="checkbox" id="intersect_check">
          <label for="intersect_check">with intersection?</label>
        </div>

        <br>

        <div id="intersection_cur_choice"></div>

        <br>
        
        <div id="years_add">
          <p><b>Number:</b></p>
          <p id="number_years">25</p>
        </div>
        

         <div id="number_container">
            <button onclick="number_years('1')">1</button>
            <button onclick="number_years('2')">2</button>
            <button onclick="number_years('3')">3</button>
            <button onclick="number_years('4')">4</button>
            <button onclick="number_years('5')">5</button>
            <button onclick="number_years('6')">6</button>
            <button onclick="number_years('7')">7</button>
            <button onclick="number_years('8')">8</button>
            <button onclick="number_years('9')">9</button>
            <button onclick="number_years('clear')">AC</button>
            <button onclick="number_years('0')">0</button>
            <button onclick="number_years('cancel')">×</button>
        </div>
        <button id="add_on_btn" onclick="add_chart()">Add</button>
    </div>
</div>

<style>
    body {
       background-color: rgb(240,240,240);
     }
           
    #mobile_container {
        display: flex;
        flex-direction: column;
        width: 100%;
    }

    #hamburger_menu_container {
        width: 100%;
        justify-content: space-between;
        align-items: center;
        display: flex;
    }
    
    #hamburger_menu {
        font-size: 35px;
        margin: 0;
        cursor: pointer;
    }
    
    #hamburger_menu_container div {
      display: flex;
      flex-direction: row;
      align-items: center;
    }
    
    #hamburger_menu_container div img {
        margin-left: auto;
        margin: 0;
        margin-right: 10px;
        width: 50px;
        height: 50px;
    }

    #hamburger_menu_container div p {
        font-size: 20px;
    }

    #hamburger_menu_container img {
        margin: 0;
        margin-right: 10px;
        width: 50px;
        height: 50px;
    }


    #greeting_mobile {
        width: 100%;
        margin-top: 50px;
        display: flex;
        justify-content: center;
        flex-direction: column;
        align-items: center;
    }

    #greeting_mobile h1 {
        margin: 0;
    }

    #greeting_mobile p {
        margin: 0;
        margin-top: 5px;
        font-size: 30px;
    }
    
    .each_chart {
      border: 1px solid black;
      margin-top: 50px;
      background-color: white;
      border-radius: 5px;
    }
    
    .each_chart div {
      display: flex;
      text-align: center;
      flex-direction: column;
    }
    
   .image_scroll_container {
    max-width: 100%;
    overflow-x: scroll;
    overflow-y: scroll;
    white-space: nowrap; /* helps force horizontal scroll */
}

.image_scroll_container img {
    width: auto;  /* ❗ allow natural width */
    height: auto;
    display: block;
    border: 1px solid black;
}


 /*Mobile form*/
    #add_on_form {
        background-color: transparent;
        width: 100%;
        height: 100%;
        position: absolute;
        top: 0;
        left: 0;
        display: none;
        justify-content: center;
        align-items: center;
    }
    #inner_add_on {
        background-color: white;
        width: 80%;
        height: 100%;
        display: flex;
        flex-direction: column;
        border: 1px solid black;
        
    }

    #inner_add_on h1 {
        text-align: center;
        justify-content: center;
    }

    #currency_add_on {
        display: flex;
    }

    #currency_add_on div {
        display: flex;
    }

   #currency_add_on div div {
    position: relative; /* KEY — this anchors the ul */
    display: flex;
    flex-direction: column;
}

#currency_add_on div div ul {
    position: absolute;
    top: 100%;          /* place dropdown directly under button */
    left: 0;            /* align left edges */
    width: 100%;        /* match button width */
    margin: 0;
    padding: 0;
    list-style: none;
    background-color: grey;
    text-align: center;
    display: none;      /* hide by default */
}

#currency_add_on div div:hover ul {
    display: block;     /* shows dropdown when hovering */
}

#currency_add_on div div li {
    padding: 5px;
    color: white;
    border-bottom: 1px solid #444;
    cursor: pointer;
}

#currency_add_on div div button {
    background-color: grey;
    color: white;
    padding: 5px 10px;
    width: 100%;        /* match dropdown width */
}


    #currency_add_on div p {
        font-size: 20px;
        margin: 0;
        margin: 0px 12px;
    }
    
    #currency_add_on p {
        font-size: 20px;
        margin: 0;
        margin: 0px 12px;
    }

    #number_container {
        display: grid;
        grid-template-columns: repeat(3, 1fr);
        height: 230px;
    }
    
    #number_container button {
      font-size: 30px;
    }
    
    #years_add {
      margin-left: 16px;
      display: flex;
      margin-bottom: 20px;
    }
    
    #years_add p {
      margin-right: 30px;
      font-size: 20px;
    }


    .time_class_form_add {
      width: 2vw;
      margin-right: 20px;
      margin-bottom: 8px;
      margin-left: 20px;
    }

    .time_label_class_form_add {
      font-size: 20px;
      margin-bottom: 8px;
    }

    
    #add_on_btn {
      font-size: 30px;
      padding: 5px 0px;
      margin-top: auto;
      background-color: rgb(60, 118, 175);
      color: white;
      border: none;
    }
    
    #close_btn_add {
      background-color: transparent;
      color: red;
      border: none;
      margin: 0;
      padding: 0;
      margin-right: auto;
      margin-left: 10px;
      font-size: 30px;
    }
    
    #container_close_btn {
      display: flex;
    }
    
    #add_chart b {
      font-size: 40px;
      text-align: center;
      cursor: pointer;
      padding: 40px;
    }

    .cancel_chart {
      display: flex;
      margin: 0;
    }

    .cancel_chart button {
      margin: 0;
      margin-right: auto;
      margin-left: 6px;
      background-color: transparent;
      color: red;
      font-size: 5vw;
      border: none;
      padding: 0;
    }

    /*Hamburger menu*/
  #hamburger_menu {
    position: absolute;
    left: 0;
    top: 0;
    display: flex;
    flex-direction: column;
    background-color: black;
    width: 0vw;
    height: 100%;
    transition: 2s;
  }

  #hamburger_menu a {
    justify-content: center;
    color: grey;
    font-size: 6vw;
    padding: 10px 10px;
    cursor: none;
    margin-left: 2vw;
    opacity: 0;
    transition: 2.5s;
  }

  #close_hamburger_menu {
    align-self: flex-end;
    margin-right: 10px;
    padding: 0;
  }
  
  hr {
    border: none;
    border-top: 1px solid grey;
    margin: 0;
    width: 100%;
  }

  #intersection_cur_choice {
    margin-left: 20px;
    display: none;
  }

  .intersect {
    margin-bottom: 10px;
    margin-right: 8px;
  }

</style>

<script>
  currencies = [
    "AUD",  // Australian Dollar
    "NZD",  // New Zealand Dollar
    "CHF",  // Swiss Franc
    "SGD", // Singapore Dollar
    "MYR",  // Malaysian Ringgit
    "JPY",
    "USD",
    "CAD", 
    "EUR",
    "HKD"
  ]

  function show_add_form() {
    document.getElementById("add_on_form").style.display = "flex";
    document.getElementById("mobile_container").style.opacity = 0.1;
  }

  function close_add_form() {
    document.getElementById("add_on_form").style.display = "none";
    document.getElementById("mobile_container").style.opacity = 1;
  }

  function from_currecies(currency) {
    document.getElementById("choice_from").innerText = currency;
    document.getElementById('list_currencies_from').style.display = "none";
  }

  function to_currecies(currency) {
    document.getElementById("choice_to").innerText = currency;
    document.getElementById('list_currencies_to').style.display = "none";
  }

  function render_currencies_from() {
    currencies.forEach(currency => {
      document.getElementById("list_currencies_from").innerHTML += `<li onclick="from_currecies('${currency}')">${currency}</li>`;
    })
  }

  function render_currencies_to() {
    currencies.forEach(currency => {
      document.getElementById("list_currencies_to").innerHTML += `<li onclick="to_currecies('${currency}')">${currency}</li>`;
    })
  }

  function render_intersection() {
     currencies.forEach(currency => {
       document.getElementById("intersection_cur_choice").innerHTML += `<input type="checkbox" name="intersection_cur" id=${currency} class="intersect" value=${currency}><label for=${currency}>${currency}</label><br>`
     })
  }

  function clear_chart(id) {
      document.getElementById(id).style.display = "none";
  }

  function open_dropdown_from() {
    const from_ul = document.getElementById('list_currencies_from');
    if (from_ul.style.display == 'block') {
        from_ul.style.display = "none";
    } else {
        from_ul.style.display = "block";
    }
  }

  function open_dropdown_to() {
    const to_ul = document.getElementById('list_currencies_to');
    if (to_ul.style.display == 'block') {
        to_ul.style.display = "none";
    } else {
        to_ul.style.display = "block";
    }
  }

  var number_years_list = [];
    function number_years(number) {
        const years = document.getElementById("number_years");
        if (number == "clear") {
            number_years_list = [];
            years.innerText = "";
        } else if(number == "cancel") {
            number_years_list = years.innerText.split("");
            number_years_list.pop();
            years.innerText = number_years_list.join("");
        }
        else {
            if (number_years_list[0] == "0") {
              alert("Zero error");
              return;
            }
            number_years_list.push(number);
            years.innerText += number;
        }
    }

    function add_chart() {
            const time = document.getElementById("number_years").innerText;
            const from_currency = document.getElementById("choice_from").innerText;
            const to_currency = document.getElementById("choice_to").innerText;
            const time_type = get_time_type();
            const intersection = intersection_checked();
            var json_data;

            if (parseInt(time) > 30 || parseInt(time) == 0) {
              alert("Years cannot be larger than 30 or equal to 0");
              return;
            } 

            if (time == "") {
              alert("No number given");
              return;
            }

            if (time_type == null) {
              alert("Please select a time type");
              return;
            }   

            if (typeof intersection == "string") {
              json_data = JSON.stringify({"symbol": `${from_currency}/${to_currency}`, "number": parseInt(time), "time_type": time_type})
            } else {
              intersection.push(from_currency);
              intersection.splice(0,0,to_currency);
              json_data = JSON.stringify({"symbol": intersection, "number": parseInt(time), "time_type": time_type})
            }

            fetch("https://financial-graph-app-fastapi.onrender.com", {
                method: "POST",
                headers: {
                  "Content-Type": "application/json"
                },
                body: json_data
            })
            .then(response => {
                if (!response.ok) {
                    alert("Error");
                }
                return response.json()
            })
            .then(data => {
                console.log("Received:", data);
                if (data.interval == null) {
                    alert("No data available");
                }
                console.log(data.id);
                console.log(data.mpld3_id);
                document.getElementById("chart_group_mobile").innerHTML += `
                  <div class="each_chart" id=${data["id"]} style='display: block;'>
                     <div class="inside_each_chart">
                      <div class="cancel_chart">
                        <button onclick="clear_chart(${data["id"]})">×</button>
                      </div>
                        <h1>${data["title"]}</h1>
                        <img src="data:image/png;base64,${data.img_string}"/>
                        <p>Time interval: ${data.interval}</p>
                     </div>
                   </div>
                `;
            })
            .catch(error => alert(error))

            close_add_form();
          }

          /*
          function other(link, main_body_id) {
             const time_type = time_type();
             fetch(`https://financial-graph-app-fastapi.onrender.com/${link}`, {
                method: "POST",
                headers: {
                  "Content-Type": "application/json"
                },
                body: JSON.stringify({"time_type": time_type, "number": parseInt(number)})
            })
            .then(response => {
                if (!response.ok) {
                    alert("Error");
                }
                return response.json()
            })
            .then(data => {
                console.log("Received:", data);
                document.getElementById(main_body_id).innerHTML += `
                   
                `
            })
            .catch(error => console.log(error))
          }
            */

          function show_hamburger_menu() {
            document.getElementById("hamburger_menu").style.width = "50vw";
            Array.from(document.getElementsByClassName("hamburger_menu_a"))
            .forEach(element => {
              element.style.opacity = 1;
              element.style.cursor = "pointer";
            });
          }
      
   function hide_hamburger_menu() {
     document.getElementById("hamburger_menu").style.width = "0vw";
     Array.from(document.getElementsByClassName("hamburger_menu_a")).forEach(element => {
       element.style.opacity = 0;
       element.style.cursor = "none";
     });
   }

   function intersection_choice() {
     if (document.getElementById("intersect_check").checked == true) {
       document.getElementById("intersection_cur_choice").style.display = "block";
     } else {
       document.getElementById("intersection_cur_choice").style.display = "none";
     }
   }

   function get_time_type() {
    var null_var;
     var time_type_value;
     const radio = Array.from(document.getElementsByName("time_type"));
     for (i=0; i < radio.length; i++) {
        if (radio[i].checked == true) {
           time_type_value = radio[i].value;
           null_var = true;
           break;
        }
     }

     if (time_type_value != null) {
       return time_type_value
     } else {
       return null
     }
   }

   function intersection_checked() {
     var intersection_list = [];
     intersection_currency = document.getElementsByName("intersection_cur");
     intersection_currency.forEach(element => {
     if (element.checked == true) {
         intersection_list.push(element.value);
       }
     })
     if (intersection_list.length == 0 || document.getElementById("intersect_check").checked != true) {
       intersection_list = "";
     }
     console.log(intersection_list);
     return intersection_list 
   }

      render_currencies_from();
      render_currencies_to();
      render_intersection();
      document.getElementById("intersect_check").addEventListener("change", intersection_choice);
</script>
</body>
</html>
